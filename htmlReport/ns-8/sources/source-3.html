


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > CounselingServiceImpl</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.example.rgybackend.Service.Impl</a>
</div>

<h1>Coverage Summary for Class: CounselingServiceImpl (org.example.rgybackend.Service.Impl)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">CounselingServiceImpl</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (13/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    83.3%
  </span>
  <span class="absValue">
    (25/30)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (83/83)
  </span>
</td>
</tr>
  <tr>
    <td class="name">CounselingServiceImpl$$SpringCGLIB$$0</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (13/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    83.3%
  </span>
  <span class="absValue">
    (25/30)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (83/83)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.example.rgybackend.Service.Impl;
&nbsp;
&nbsp;import java.time.DayOfWeek;
&nbsp;import java.time.LocalDate;
&nbsp;import java.time.LocalDateTime;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;import java.util.Random;
&nbsp;
&nbsp;import org.example.rgybackend.DAO.AvailableDAO;
&nbsp;import org.example.rgybackend.DAO.CounselingDAO;
&nbsp;import org.example.rgybackend.DAO.NotificationPrivateDAO;
&nbsp;import org.example.rgybackend.DAO.PsyExtraDAO;
&nbsp;import org.example.rgybackend.DAO.UserDAO;
&nbsp;import org.example.rgybackend.DTO.ProfileTag;
&nbsp;import org.example.rgybackend.DTO.PsyCommentData;
&nbsp;import org.example.rgybackend.Entity.Counseling;
&nbsp;import org.example.rgybackend.Model.AvailableTimeModel;
&nbsp;import org.example.rgybackend.Model.CounselingModel;
&nbsp;import org.example.rgybackend.Model.NotificationPrivateModel;
&nbsp;import org.example.rgybackend.Model.TagModel;
&nbsp;import org.example.rgybackend.Service.CounselingService;
&nbsp;import org.example.rgybackend.Service.MilestoneServive;
&nbsp;import org.example.rgybackend.Utils.CacheUtil;
&nbsp;import org.example.rgybackend.Utils.NotificationUtil;
&nbsp;import org.example.rgybackend.Utils.TimeUtil;
&nbsp;import org.springframework.beans.factory.annotation.Autowired;
&nbsp;import org.springframework.cache.annotation.CacheEvict;
&nbsp;import org.springframework.stereotype.Service;
&nbsp;
&nbsp;@Service
<b class="fc">&nbsp;public class CounselingServiceImpl implements CounselingService {</b>
&nbsp;    @Autowired
&nbsp;    private CounselingDAO counselingDAO;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private AvailableDAO availableDAO;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private NotificationPrivateDAO notificationPrivateDAO;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private PsyExtraDAO psyExtraDAO;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private UserDAO userDAO;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private CacheUtil cacheUtil;
&nbsp;
&nbsp;    @Autowired
&nbsp;    private MilestoneServive milestoneServive;
&nbsp;
&nbsp;    @Override
&nbsp;    public List&lt;CounselingModel&gt; getCounseling(String psyid) {
<b class="fc">&nbsp;        return counselingDAO.getCounseling(psyid);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public List&lt;CounselingModel&gt; getUserCounseling(String userid) {
<b class="fc">&nbsp;        return counselingDAO.getUserCounseling(userid);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public List&lt;CounselingModel&gt; getDateCounseling(String psyid, Long timestamp) {
<b class="fc">&nbsp;        LocalDate date = TimeUtil.getLocalDate(timestamp);</b>
<b class="fc">&nbsp;        return counselingDAO.getDateCounseling(psyid, date);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean addCounseling(CounselingModel counselingModel, String userid) {
<b class="fc">&nbsp;        milestoneServive.addMilestone(userid, 6L);</b>
&nbsp;
<b class="fc">&nbsp;        NotificationPrivateModel notificationForUser = new NotificationPrivateModel(NotificationUtil.counselingNew);</b>
<b class="fc">&nbsp;        notificationForUser.setAdminid(&quot;System&quot;);</b>
<b class="fc">&nbsp;        notificationForUser.setUserid(userid);</b>
<b class="fc">&nbsp;        notificationPrivateDAO.addNotification(notificationForUser);</b>
&nbsp;
<b class="fc">&nbsp;        NotificationPrivateModel notificationForPsy = new NotificationPrivateModel(NotificationUtil.counselingNewOrder);</b>
<b class="fc">&nbsp;        notificationForPsy.setAdminid(&quot;System&quot;);</b>
<b class="fc">&nbsp;        notificationForPsy.setUserid(counselingModel.getPsyid());</b>
<b class="fc">&nbsp;        notificationPrivateDAO.addNotification(notificationForPsy);</b>
&nbsp;
<b class="fc">&nbsp;        return counselingDAO.addCounseling(counselingModel, userid);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    @CacheEvict(value = &quot;psyprofile&quot;, key = &quot;#psyCommentData.psyid&quot;)
&nbsp;    public boolean addComment(PsyCommentData psyCommentData) {
<b class="fc">&nbsp;        return psyExtraDAO.addComments(psyCommentData);</b>
&nbsp;    }
&nbsp;
&nbsp;    // 0--&gt;pending, 1--&gt;accepted, 2--&gt;finished, 3--&gt;rejected
&nbsp;    @Override
&nbsp;    public boolean setStatus(Long counselingid, Long status, String userid) {      
<b class="fc">&nbsp;        Counseling counseling = counselingDAO.getCounselingById(counselingid);</b>
<b class="fc">&nbsp;        Long role = userDAO.getRole(userid);</b>
<b class="fc">&nbsp;        if(status == 1) {</b>
<b class="fc">&nbsp;            NotificationPrivateModel notification = new NotificationPrivateModel(NotificationUtil.counselingAccepted);</b>
<b class="fc">&nbsp;            notification.setAdminid(counseling.getPsyid());</b>
<b class="fc">&nbsp;            notification.setUserid(counseling.getUserid());</b>
<b class="fc">&nbsp;            notificationPrivateDAO.addNotification(notification);</b>
&nbsp;        }
<b class="fc">&nbsp;        else if(status == 2) {</b>
<b class="fc">&nbsp;            NotificationPrivateModel notification = new NotificationPrivateModel(NotificationUtil.counselingFinished);</b>
<b class="fc">&nbsp;            notification.setAdminid(counseling.getPsyid());</b>
<b class="fc">&nbsp;            notification.setUserid(counseling.getUserid());</b>
<b class="fc">&nbsp;            notificationPrivateDAO.addNotification(notification);</b>
<b class="fc">&nbsp;            psyExtraDAO.increaseClients(counseling.getPsyid());</b>
<b class="fc">&nbsp;            cacheUtil.evictPsyProfileCache(counseling.getPsyid());</b>
&nbsp;        }
<b class="pc">&nbsp;        else if(status == 3) {</b>
<b class="fc">&nbsp;            if(role == 0) {</b>
<b class="fc">&nbsp;                NotificationPrivateModel notification = new NotificationPrivateModel(NotificationUtil.counselingCanceled);</b>
<b class="fc">&nbsp;                notification.setAdminid(&quot;System&quot;);</b>
<b class="fc">&nbsp;                notification.setUserid(counseling.getPsyid());</b>
<b class="fc">&nbsp;                notificationPrivateDAO.addNotification(notification);</b>
&nbsp;            }
<b class="pc">&nbsp;            else if(role == 2) {</b>
<b class="fc">&nbsp;                NotificationPrivateModel notification = new NotificationPrivateModel(NotificationUtil.counselingRejected);</b>
<b class="fc">&nbsp;                notification.setAdminid(counseling.getPsyid());</b>
<b class="fc">&nbsp;                notification.setUserid(counseling.getUserid());</b>
<b class="fc">&nbsp;                notificationPrivateDAO.addNotification(notification);</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return counselingDAO.setStatus(counselingid, status);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean removeCounseling(Long counselingid) {
<b class="fc">&nbsp;        return counselingDAO.remove(counselingid);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public AvailableTimeModel getAvailableTime(String psyid) {
<b class="fc">&nbsp;        return availableDAO.getAvailableTime(psyid);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public List&lt;Long&gt; getDateAvailables(String psyid, Long timestamp) {
<b class="fc">&nbsp;        AvailableTimeModel availableTimeModel = availableDAO.getAvailableTime(psyid);</b>
<b class="fc">&nbsp;        LocalDate date = TimeUtil.getLocalDate(timestamp);</b>
<b class="fc">&nbsp;        List&lt;Long&gt; workingslots = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        List&lt;Long&gt; dateAvailables = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;        if(date.getDayOfWeek() == DayOfWeek.MONDAY) {</b>
<b class="fc">&nbsp;            workingslots = availableTimeModel.getMonday();</b>
&nbsp;        } 
<b class="fc">&nbsp;        else if(date.getDayOfWeek() == DayOfWeek.TUESDAY) {</b>
<b class="fc">&nbsp;            workingslots = availableTimeModel.getTuesday();</b>
&nbsp;        } 
<b class="fc">&nbsp;        else if(date.getDayOfWeek() == DayOfWeek.WEDNESDAY) {</b>
<b class="fc">&nbsp;            workingslots = availableTimeModel.getWednesday();</b>
&nbsp;        } 
<b class="fc">&nbsp;        else if(date.getDayOfWeek() == DayOfWeek.THURSDAY) {</b>
<b class="fc">&nbsp;            workingslots = availableTimeModel.getThursday();</b>
&nbsp;        } 
<b class="fc">&nbsp;        else if(date.getDayOfWeek() == DayOfWeek.FRIDAY) {</b>
<b class="fc">&nbsp;            workingslots = availableTimeModel.getFriday();</b>
&nbsp;        } 
<b class="fc">&nbsp;        else if(date.getDayOfWeek() == DayOfWeek.SATURDAY) {</b>
<b class="fc">&nbsp;            workingslots = availableTimeModel.getSaturday();</b>
&nbsp;        } 
<b class="pc">&nbsp;        else if(date.getDayOfWeek() == DayOfWeek.SUNDAY) {</b>
<b class="fc">&nbsp;            workingslots = availableTimeModel.getSunday();</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        for(Long slot : workingslots) {</b>
<b class="fc">&nbsp;            LocalDateTime ldt = TimeUtil.getLocalDateTime(date, slot);</b>
<b class="pc">&nbsp;            if(TimeUtil.getTimestamp(ldt) &lt; TimeUtil.now()) {</b>
&nbsp;                continue;
&nbsp;            }
<b class="fc">&nbsp;            boolean counseled = counselingDAO.counseled(psyid, TimeUtil.getTimestamp(ldt));</b>
<b class="pc">&nbsp;            if(!counseled) {</b>
<b class="fc">&nbsp;                dateAvailables.add(slot);</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return dateAvailables;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean setAvailableTimes(AvailableTimeModel availableTimeModel) {
<b class="fc">&nbsp;        return availableDAO.setAvailableTimes(availableTimeModel);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public List&lt;TagModel&gt; getTypeTags() {
<b class="fc">&nbsp;        return new CounselingModel().typeTags;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean placeCallBackRequest(String userid) {
<b class="fc">&nbsp;        NotificationPrivateModel notificationForUser = new NotificationPrivateModel(NotificationUtil.callBackNotifyForUser);</b>
<b class="fc">&nbsp;        notificationForUser.setAdminid(&quot;System&quot;);</b>
<b class="fc">&nbsp;        notificationForUser.setUserid(userid);</b>
<b class="fc">&nbsp;        notificationPrivateDAO.addNotification(notificationForUser);</b>
&nbsp;
<b class="fc">&nbsp;        List&lt;ProfileTag&gt; psyProfileTags = userDAO.getPsyProfileTags();</b>
<b class="fc">&nbsp;        Random random = new Random();</b>
<b class="fc">&nbsp;        final int psyIndex = random.nextInt(psyProfileTags.size());</b>
&nbsp;
<b class="fc">&nbsp;        NotificationPrivateModel notificationForPsy = NotificationUtil.getCallBackNotifyForPsy(userid);</b>
<b class="fc">&nbsp;        notificationForPsy.setAdminid(&quot;System&quot;);</b>
<b class="fc">&nbsp;        notificationForPsy.setUserid(psyProfileTags.get(psyIndex).getUserid());</b>
<b class="fc">&nbsp;        notificationPrivateDAO.addNotification(notificationForPsy);</b>
&nbsp;
<b class="fc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-07-17 21:48</div>
</div>
</body>
</html>
